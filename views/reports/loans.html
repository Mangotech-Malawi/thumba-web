<!-- Container fluid -->
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">

        <!-- FILTER SECTION -->
        <div class="card-header all-report-filter">
          <div class="row align-items-end">
            <!-- Start Date -->
            <div class="col-sm-12 col-md-6 col-lg-2">
              <div class="form-group">
                <label>Start Date</label>
                <div class="input-group date" id="loanReportStartDatePicker" data-target-input="nearest">
                  <div class="input-group-prepend" data-target="#loanReportStartDatePicker" data-toggle="datetimepicker">
                    <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                  </div>
                  <input type="text" id="loanReportStartDate" class="form-control datetimepicker-input"
                    data-target="#loanReportStartDatePicker" />
                </div>
              </div>
            </div>

            <!-- End Date -->
            <div class="col-sm-12 col-md-6 col-lg-2">
              <div class="form-group">
                <label>End Date</label>
                <div class="input-group date" id="loanReportEndDatePicker" data-target-input="nearest">
                  <div class="input-group-prepend" data-target="#loanReportEndDatePicker" data-toggle="datetimepicker">
                    <span class="input-group-text"><i class="far fa-calendar-alt"></i></span>
                  </div>
                  <input type="text" id="loanReportEndDate" class="form-control datetimepicker-input"
                    data-target="#loanReportEndDatePicker" />
                </div>
              </div>
            </div>

            <!-- Filter Button -->
            <div class="col-sm-12 col-md-6 col-lg-2">
              <div class="form-group">
                <label class="d-none d-lg-block">&nbsp;</label>
                <button id="loanReportFilterBtn" class="btn btn-primary btn-block">
                  <i class="fas fa-filter"></i> Filter
                </button>
              </div>
            </div>

            <!-- Export Dropdown -->
            <div class="col-sm-12 col-md-6 col-lg-2">
              <div class="form-group">
                <label class="d-none d-lg-block">&nbsp;</label>
                <div class="dropdown">
                  <button class="btn btn-outline-success btn-block dropdown-toggle" type="button" id="exportDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-file-export"></i> Export
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="exportDropdown">
                    <li><a class="dropdown-item" href="#" id="exportCSV">Print to CSV</a></li>
                    <li><a class="dropdown-item" href="#" id="exportPDF">Print to PDF</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- REPORT TABLE SECTION -->
        <div class="card-body">

          <!-- HEADER INSIDE REPORT TABLE AREA -->

          <!-- HEADER INSIDE REPORT TABLE AREA -->
          <div class="d-flex justify-content-between align-items-center flex-wrap border rounded p-3 mb-4">
            <!-- Left: Logo + Report Title -->
            <div class="d-flex align-items-center mb-2 mb-md-0">
              <img src="#" alt="Company Logo" class="me-3 account-logo" style="height: 55px; width: auto;">
              <div>
                <h5 class="fw-bold text-uppercase mb-0 ml-2">Loans Report</h5>
                <h7 id="report-company-name" class="text-muted account-name ml-2 h">Company Name Here</h7>
              </div>
            </div>

            <!-- Right: Date Range -->
            <div class="text-end">
              <p class="mb-1 fw-semibold text-dark">
                <i class="far fa-calendar-alt text-orange me-2"></i>
                <span id="loanReportDateRange" >1 Oct 2025 - 17 Oct 2025</span>
              </p>
              <small class="text-muted">Generated on: <span id="loanReportGeneratedDate"></span></small>
            </div>
          </div>

          <!-- REPORT TABLE -->
          <div id="tab">
            <table id="loan-client-stats-report" name="LoanClientStats"
              class="table table-bordered table-hover report-table">
              <thead class="table-light">
                <tr>
                  <th>Category</th>
                  <th>Definition</th>
                  <th>Value</th>
                </tr>
              </thead>
              <tbody>
                <!-- Clients Section -->
                <tr>
                  <td rowspan="9" style="width: 20%">Clients</td>
                  <td>Total Clients</td>
                  <td id="totalClients"></td>
                </tr>
                <tr>
                  <td>Active Clients</td>
                  <td id="activeClients"></td>
                </tr>
                <tr>
                  <td>Dormant Clients</td>
                  <td id="dormantClients"></td>
                </tr>
                <tr>
                  <td>Individual Clients</td>
                  <td id="individualClients"></td>
                </tr>
                <tr>
                  <td>Group Clients</td>
                  <td id="groupClients"></td>
                </tr>
                <tr>
                  <td>Institutional Clients</td>
                  <td id="institutionalClients"></td>
                </tr>
                <tr>
                  <td>Investors</td>
                  <td id="investorsCount"></td>
                </tr>
                <tr>
                  <td>Loan Applicants</td>
                  <td id="loanApplicantsCount"></td>
                </tr>
                <tr>
                  <td>Client Growth Rate (%)</td>
                  <td id="clientGrowthRate"></td>
                </tr>

                <!-- Loan Applications -->
                <tr>
                  <td rowspan="6">Loan Applications</td>
                  <td>Total Applications</td>
                  <td id="totalApplications"></td>
                </tr>
                <tr>
                  <td>Approved Applications</td>
                  <td id="approvedApplications"></td>
                </tr>
                <tr>
                  <td>Rejected Applications</td>
                  <td id="rejectedApplications"></td>
                </tr>
                <tr>
                  <td>Pending Applications</td>
                  <td id="pendingApplications"></td>
                </tr>
                <tr>
                  <td>Approval Rate (%)</td>
                  <td id="approvalRate"></td>
                </tr>
                <tr>
                  <td>Average Loan Size</td>
                  <td id="avgLoanSize"></td>
                </tr>

                <!-- Loan Disbursement -->
                <tr>
                  <td rowspan="5">Loan Disbursements</td>
                  <td>Total Disbursed Amount</td>
                  <td id="totalDisbursed"></td>
                </tr>
                <tr>
                  <td>Disbursement Rate (%)</td>
                  <td id="disbursementRate"></td>
                </tr>
                <tr>
                  <td>Active Loans</td>
                  <td id="activeLoans"></td>
                </tr>
                <tr>
                  <td>Closed Loans</td>
                  <td id="closedLoans"></td>
                </tr>
                <tr>
                  <td>Average Disbursement Time</td>
                  <td id="avgDisbTime"></td>
                </tr>

                <!-- Loan Repayments -->
                <tr>
                  <td rowspan="6">Repayments & Recovery</td>
                  <td>Total Repaid Amount</td>
                  <td id="totalRepaid"></td>
                </tr>
                <tr>
                  <td>Outstanding Balance</td>
                  <td id="outstandingBalance"></td>
                </tr>
                <tr>
                  <td>Total Defaulters</td>
                  <td id="totalDefaulters"></td>
                </tr>
                <tr>
                  <td>Recovery Rate (%)</td>
                  <td id="recoveryRate"></td>
                </tr>
                <tr>
                  <td>PAR (Portfolio at Risk)</td>
                  <td id="par"></td>
                </tr>
                <tr>
                  <td>Write-offs</td>
                  <td id="writeOffs"></td>
                </tr>

              
              </tbody>
            </table>

            <hr class="my-4">

            <h5 class="fw-bold text-uppercase text-primary">Loan Products Performance</h5>
            <table id="loanProductsTable" class="table table-bordered table-hover report-table">
              <thead class="table">
                <tr>
                  <th>Product Name</th>
                  <th>Total Loans</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

            <h5 class="fw-bold text-uppercase text-success mt-4">Investment Products Performance</h5>
            <table id="investmentProductsTable" class="table table-bordered table-hover report-table">
              <thead class="table">
                <tr>
                  <th>Product Name</th>
                  <th>Total Subscriptions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script>
  $(function () {
    // Initialize date pickers
    $(".date").datetimepicker({ format: "DD/MMM/YYYY" });

    // Show today's date
    const today = new Date();
    $("#loanReportGeneratedDate").text(today.toLocaleDateString("en-GB", {
      day: "2-digit", month: "short", year: "numeric"
    }));

    // Update report header when Filter clicked
    $('#filterBtn').on('click', function () {
      const start = $('#startDate').val() || 'Start not set';
      const end = $('#endDate').val() || 'End not set';
      $('#loanReportDateRange').text(`${start} - ${end}`);
    });

    $(".account-name").text(sessionStorage.getItem("account_name"));
    $(".account-logo").attr("src", sessionStorage.getItem("account_logo"));
  });
</script>


<!-- Custom Styles -->
<style>
  .text-orange {
    color: #ff8c00 !important;
  }

  .table th,
  .table td {
    vertical-align: middle;
  }

  .report-table {
    font-size: 0.95rem;
  }
</style>